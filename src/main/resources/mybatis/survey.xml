<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dev.mvc.survey.SurveyDAOInter">
  <insert id="create" parameterType="dev.mvc.survey.SurveyVO">
INSERT INTO survey (
    surveyno, topic, startdate, enddate, cnt, continueyn
) VALUES (
    survey_seq.nextval, #{topic}, #{startdate}, TO_CHAR(SYSDATE, 'YYYY-MM-DD HH24:MI:SS'), 0, 'Y')
</insert>


<!-- 카테고리별 검색 + 페이징 목록 -->
  <select id="list_by_classifyno_search_paging" resultType="dev.mvc.survey.SurveyVO" parameterType="HashMap">
    SELECT  surveyno, topic, startdate, enddate, cnt, continueyn,  r
    FROM (
        SELECT  surveyno, topic, startdate, enddate, cnt, continueyn, rownum as r
        FROM (
            SELECT  surveyno, topic, startdate, enddate, cnt, continueyn
            FROM Survey
            <choose>
                <otherwise>
                    WHERE UPPER(topic) LIKE '%' || UPPER(#{word}) || '%'
                </otherwise>
            </choose>
            ORDER BY surveyno DESC
        )
    )
    WHERE <![CDATA[ r >= #{start_num} AND r <= #{end_num} ]]>
    
</select>



<!-- 카테고리별 검색 레코드 갯수 -->
  <select id="list_by_classifyno_search_count" resultType="int" parameterType="HashMap">
    SELECT COUNT(*) as cnt
    FROM Survey
    <choose>
      <when test="word == null or word == ''"> <!-- 검색하지 않는 경우의 레코드 갯수 -->
      </when>
      <otherwise> <!-- 검색하는 경우의 레코드 갯수 -->
        WHERE UPPER(topic) LIKE '%' || UPPER(#{word}) || '%' 
      </otherwise>
    </choose>
  </select>   


  <select id="read" resultType="dev.mvc.survey.SurveyVO">
    SELECT *
    FROM Survey
    where surveyno = #{surveyno}
  </select>
  
    <select id="read_item" resultType="dev.mvc.survey.SurveyVO" parameterType="Integer">
    SELECT *
    FROM Surveyitem
    where surveyno = #{surveyno}
  </select>
  
    <!-- 모든 카테고리의 등록된 글목록 -->
  <select id="read_item_list" resultType="dev.mvc.survey.SurveyVO">
    SELECT *
    FROM Surveyitem
    where surveyno = #{surveyno}
  </select>
</mapper>
