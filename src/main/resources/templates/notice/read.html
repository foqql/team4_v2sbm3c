<!DOCTYPE html>
<html layout:decorate="~{layout}">
<head>
    <title>공지사항 상세</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
        }
        .container {
            width: 60%;
            margin: 20px auto;
            background-color: #fff;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        h1 {
            text-align: center;
        }
        .content {
            margin-top: 20px;
            width: 70%; /* 가로폭 설정 */
            margin: 0 auto; /* 가운데 정렬 */
        }
        .content.centered {
            text-align: center; /* 중앙 정렬 */
        }
        .content label {
            font-weight: bold;
            display: block; /* 블록 요소로 설정하여 아래 여백 추가 */
            margin-bottom: 10px; /* 아래 여백 설정 */
        }
        .content p {
            margin: 10px 0 30px; /* 아래 여백 설정 */
        }
        .center-link {
            text-align: center; /* 중앙 정렬 */
            margin-top: 20px;
        }
        .center-link a {
            display: block;
            width: 200px;
            margin: 20px auto;
            padding: 10px 0;
            text-align: center;
            background-color: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 4px;
        }
        .center-link a:hover {
            background-color: #45a049;
        }
        #hart_panel {
            text-align: center;
            margin-top: 20px;
        }
    </style>
    <script>
        window.onload = function() {
            let hartCnt = '[[${hartCnt}]]'; // Thymeleaf로부터 추천 상태를 받음
            let tag = '';
            
            // 추천 상태에 따라 추천 버튼 설정
            if (hartCnt == 1) {
                tag = '<a href="javascript:good([[${noticeVO.notino}]])"><img src="/contents/images/hart_on_50.png" style="width: 22px" title="추천"></a>';
            } else {
                tag = '<a href="javascript:good([[${noticeVO.notino}]])"><img src="/contents/images/hart_off_50.png" style="width: 22px" title="추천"></a>';
            }
            document.querySelector('#hart_panel').innerHTML = tag;
            document.querySelector('#recom_panel').innerHTML = '([[${recom}]])';  // 수정된 부분
        }

        function good(notino) {
            console.log('-> notino: ' + notino);

            fetch("/notice/good", {
                "method": "post",
                "headers": {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({notino}) // JSON 형식으로 서버에 전달
            })
            .then((response) => response.json())
            .then((data) => {
                if (data.isMember == 1) { // 회원인 경우
                    let hartCnt = data.hartCnt; // 추천 상태
                    let tag = '';
                    
                    // 추천 상태에 따라 버튼 이미지 변경
                    if (hartCnt == 1) {
                        tag = '<a href="javascript:good([[${noticeVO.notino}]])"><img src="/contents/images/hart_on_50.png" style="width: 22px" title="추천"></a>';
                    } else {
                        tag = '<a href="javascript:good([[${noticeVO.notino}]])"><img src="/contents/images/hart_off_50.png" style="width: 22px" title="추천"></a>';
                    }
                    document.querySelector('#hart_panel').innerHTML = tag;
                    document.querySelector('#recom_panel').innerHTML = '(' + data.recom + ')';
                } else { // 비회원인 경우
                    alert("로그인해야 추천할 수 있습니다.");
                    location.href = '/member/login_cookie_need';  // 로그인 페이지로 이동
                }
            });
        }
    </script>
</head>
<body>
    <div layout:fragment="content" class="notice-container">
        <h1>공지사항 상세</h1>
        <div class="content centered">
            <label>제목:</label>
            <p th:text="${noticeVO.title}"></p>
        </div>
        <div class="content">
            <label>내용:</label>
            <p th:text="${noticeVO.content}"></p>
        </div>
        <div class="content centered">
            <label>등록일시:</label>
            <p th:text="${#dates.format(noticeVO.nodate, 'yyyy-MM-dd HH:mm:ss')}"></p>
        </div>
        
        <!-- 추천 버튼과 추천 수 표시 -->
        <div class="content centered">
            <label>추천:</label>
            <span id="hart_panel"></span>
            <span id="recom_panel"></span>
        </div>

        <div class="center-link">
            <a href="/notice/list">목록으로 돌아가기</a>
        </div>
    </div>
</body>
</html>
